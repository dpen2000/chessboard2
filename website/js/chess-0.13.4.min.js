/*! chess.js v0.13.4 | (c) 2022, Jeff Hlywa (jhlywa@gmail.com) | BSD-2-Clause | https://github.com/jhlywa/chess.js/blob/master/LICENSE */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(k){return k.raw=k};$jscomp.createTemplateTagFirstArgWithRaw=function(k,q){k.raw=q;return k};$jscomp.arrayIteratorImpl=function(k){var q=0;return function(){return q<k.length?{done:!1,value:k[q++]}:{done:!0}}};$jscomp.arrayIterator=function(k){return{next:$jscomp.arrayIteratorImpl(k)}};$jscomp.makeIterator=function(k){var q="undefined"!=typeof Symbol&&Symbol.iterator&&k[Symbol.iterator];return q?q.call(k):$jscomp.arrayIterator(k)};
var SYMBOLS$$module$Input_0="pnbrqkPNBRQK",DEFAULT_POSITION$$module$Input_0="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",TERMINATION_MARKERS$$module$Input_0=["1-0","0-1","1/2-1/2","*"],PAWN_OFFSETS$$module$Input_0={b:[16,32,17,15],w:[-16,-32,-17,-15]},PIECE_OFFSETS$$module$Input_0={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ATTACKS$$module$Input_0=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,
0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],RAYS$$module$Input_0=
[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,
0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],SHIFTS$$module$Input_0={p:0,n:1,b:2,r:3,q:4,k:5},BITS$$module$Input_0={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},RANK_1$$module$Input_0=7,RANK_2$$module$Input_0=6,RANK_3$$module$Input_0=5,RANK_4$$module$Input_0=4,RANK_5$$module$Input_0=3,RANK_6$$module$Input_0=2,RANK_7$$module$Input_0=1,RANK_8$$module$Input_0=0,SQUARE_MAP$$module$Input_0={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,
e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ROOKS$$module$Input_0={w:[{square:SQUARE_MAP$$module$Input_0.a1,flag:BITS$$module$Input_0.QSIDE_CASTLE},{square:SQUARE_MAP$$module$Input_0.h1,flag:BITS$$module$Input_0.KSIDE_CASTLE}],
b:[{square:SQUARE_MAP$$module$Input_0.a8,flag:BITS$$module$Input_0.QSIDE_CASTLE},{square:SQUARE_MAP$$module$Input_0.h8,flag:BITS$$module$Input_0.KSIDE_CASTLE}]},PARSER_STRICT$$module$Input_0=0,PARSER_SLOPPY$$module$Input_0=1;
function get_disambiguator$$module$Input_0(k,q){for(var z=k.from,F=k.to,W=k.piece,v=0,R=0,L=0,M=0,X=q.length;M<X;M++){var S=q[M].from,y=q[M].to;W===q[M].piece&&z!==S&&F===y&&(v++,rank$$module$Input_0(z)===rank$$module$Input_0(S)&&R++,file$$module$Input_0(z)===file$$module$Input_0(S)&&L++)}return 0<v?0<R&&0<L?algebraic$$module$Input_0(z):0<L?algebraic$$module$Input_0(z).charAt(1):algebraic$$module$Input_0(z).charAt(0):""}
function infer_piece_type$$module$Input_0(k){var q=k.charAt(0);if("a"<=q&&"h">=q)return k.match(/[a-h]\d.*[a-h]\d/)?void 0:PAWN$$module$Input_0;q=q.toLowerCase();return"o"===q?KING$$module$Input_0:q}function stripped_san$$module$Input_0(k){return k.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function rank$$module$Input_0(k){return k>>4}function file$$module$Input_0(k){return k&15}
function algebraic$$module$Input_0(k){var q=file$$module$Input_0(k);k=rank$$module$Input_0(k);return"abcdefgh".substring(q,q+1)+"87654321".substring(k,k+1)}function swap_color$$module$Input_0(k){return k===WHITE$$module$Input_0?BLACK$$module$Input_0:WHITE$$module$Input_0}function is_digit$$module$Input_0(k){return-1!=="0123456789".indexOf(k)}function clone$$module$Input_0(k){var q=k instanceof Array?[]:{},z;for(z in k)q[z]="object"===typeof z?clone$$module$Input_0(k[z]):k[z];return q}
function trim$$module$Input_0(k){return k.replace(/^\s+|\s+$/g,"")}
var BLACK$$module$Input_0="b",WHITE$$module$Input_0="w",EMPTY$$module$Input_0=-1,PAWN$$module$Input_0="p",KNIGHT$$module$Input_0="n",BISHOP$$module$Input_0="b",ROOK$$module$Input_0="r",QUEEN$$module$Input_0="q",KING$$module$Input_0="k",SQUARES$$module$Input_0=function(){for(var k=[],q=SQUARE_MAP$$module$Input_0.a8;q<=SQUARE_MAP$$module$Input_0.h1;q++)q&136?q+=7:k.push(algebraic$$module$Input_0(q));return k}(),FLAGS$$module$Input_0={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",
KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Chess$$module$Input_0=function(k){function q(a){"undefined"===typeof a&&(a=!1);h=Array(128);w={w:EMPTY$$module$Input_0,b:EMPTY$$module$Input_0};u=WHITE$$module$Input_0;t={w:0,b:0};G=EMPTY$$module$Input_0;D=0;N=1;H=[];a||(A={});x={};L(v())}function z(){for(var a=[],c={};0<H.length;)a.push(O());var b=v();b in x&&(c[b]=x[b]);for(;0<a.length;)I(a.pop()),b=v(),b in x&&(c[b]=x[b]);x=c}function F(a,c){"undefined"===typeof c&&(c=!1);var b=a.split(/\s+/),d=b[0],e=0;if(!W(a).valid)return!1;
q(c);for(var f=0;f<d.length;f++){var g=d.charAt(f);if("/"===g)e+=8;else if(is_digit$$module$Input_0(g))e+=parseInt(g,10);else{var n="a">g?WHITE$$module$Input_0:BLACK$$module$Input_0;X({type:g.toLowerCase(),color:n},algebraic$$module$Input_0(e));e++}}u=b[1];-1<b[2].indexOf("K")&&(t.w|=BITS$$module$Input_0.KSIDE_CASTLE);-1<b[2].indexOf("Q")&&(t.w|=BITS$$module$Input_0.QSIDE_CASTLE);-1<b[2].indexOf("k")&&(t.b|=BITS$$module$Input_0.KSIDE_CASTLE);-1<b[2].indexOf("q")&&(t.b|=BITS$$module$Input_0.QSIDE_CASTLE);
G="-"===b[3]?EMPTY$$module$Input_0:SQUARE_MAP$$module$Input_0[b[3]];D=parseInt(b[4],10);N=parseInt(b[5],10);L(v());return!0}function W(a){var c={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",
8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"};a=a.split(/\s+/);if(6!==a.length)return{valid:!1,error_number:1,error:c[1]};if(isNaN(parseInt(a[5]))||0>=parseInt(a[5],10))return{valid:!1,error_number:2,error:c[2]};if(isNaN(parseInt(a[4]))||0>parseInt(a[4],10))return{valid:!1,error_number:3,error:c[3]};if(!/^(-|[abcdefgh][36])$/.test(a[3]))return{valid:!1,
error_number:4,error:c[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(a[2]))return{valid:!1,error_number:5,error:c[5]};if(!/^(w|b)$/.test(a[1]))return{valid:!1,error_number:6,error:c[6]};var b=a[0].split("/");if(8!==b.length)return{valid:!1,error_number:7,error:c[7]};for(var d=0;d<b.length;d++){for(var e=0,f=!1,g=0;g<b[d].length;g++)if(isNaN(b[d][g])){if(!/^[prnbqkPRNBQK]$/.test(b[d][g]))return{valid:!1,error_number:9,error:c[9]};e+=1;f=!1}else{if(f)return{valid:!1,error_number:8,error:c[8]};e+=parseInt(b[d][g],
10);f=!0}if(8!==e)return{valid:!1,error_number:10,error:c[10]}}return"3"==a[3][1]&&"w"==a[1]||"6"==a[3][1]&&"b"==a[1]?{valid:!1,error_number:11,error:c[11]}:{valid:!0,error_number:0,error:c[0]}}function v(){for(var a=0,c="",b=SQUARE_MAP$$module$Input_0.a8;b<=SQUARE_MAP$$module$Input_0.h1;b++){if(null==h[b])a++;else{0<a&&(c+=a,a=0);var d=h[b].type;c+=h[b].color===WHITE$$module$Input_0?d.toUpperCase():d.toLowerCase()}b+1&136&&(0<a&&(c+=a),b!==SQUARE_MAP$$module$Input_0.h1&&(c+="/"),a=0,b+=8)}a="";t[WHITE$$module$Input_0]&
BITS$$module$Input_0.KSIDE_CASTLE&&(a+="K");t[WHITE$$module$Input_0]&BITS$$module$Input_0.QSIDE_CASTLE&&(a+="Q");t[BLACK$$module$Input_0]&BITS$$module$Input_0.KSIDE_CASTLE&&(a+="k");t[BLACK$$module$Input_0]&BITS$$module$Input_0.QSIDE_CASTLE&&(a+="q");a=a||"-";b=G===EMPTY$$module$Input_0?"-":algebraic$$module$Input_0(G);return[c,u,a,b,D,N].join(" ")}function R(a){for(var c=0;c<a.length;c+=2)"string"===typeof a[c]&&"string"===typeof a[c+1]&&(A[a[c]]=a[c+1]);return A}function L(a){0<H.length||(a!==DEFAULT_POSITION$$module$Input_0?
(A.SetUp="1",A.FEN=a):(delete A.SetUp,delete A.FEN))}function M(a){return(a=h[SQUARE_MAP$$module$Input_0[a]])?{type:a.type,color:a.color}:null}function X(a,c){if(!("type"in a&&"color"in a&&-1!==SYMBOLS$$module$Input_0.indexOf(a.type.toLowerCase())&&c in SQUARE_MAP$$module$Input_0))return!1;var b=SQUARE_MAP$$module$Input_0[c];if(a.type==KING$$module$Input_0&&w[a.color]!=EMPTY$$module$Input_0&&w[a.color]!=b)return!1;h[b]={type:a.type,color:a.color};a.type===KING$$module$Input_0&&(w[a.color]=b);L(v());
return!0}function S(a,c,b,d,e){c={color:u,from:c,to:b,flags:d,piece:a[c].type};e&&(c.flags|=BITS$$module$Input_0.PROMOTION,c.promotion=e);a[b]?c.captured=a[b].type:d&BITS$$module$Input_0.EP_CAPTURE&&(c.captured=PAWN$$module$Input_0);return c}function y(a){function c(P,T,J,K,ca){if(P[J].type!==PAWN$$module$Input_0||rank$$module$Input_0(K)!==RANK_8$$module$Input_0&&rank$$module$Input_0(K)!==RANK_1$$module$Input_0)T.push(S(P,J,K,ca));else for(var da=[QUEEN$$module$Input_0,ROOK$$module$Input_0,BISHOP$$module$Input_0,
KNIGHT$$module$Input_0],Z=0,ha=da.length;Z<ha;Z++)T.push(S(P,J,K,ca,da[Z]))}var b=[],d=u,e=swap_color$$module$Input_0(d),f={b:RANK_7$$module$Input_0,w:RANK_2$$module$Input_0},g=SQUARE_MAP$$module$Input_0.a8,n=SQUARE_MAP$$module$Input_0.h1,C=!1,B="undefined"!==typeof a&&"legal"in a?a.legal:!0,l="undefined"!==typeof a&&"piece"in a&&"string"===typeof a.piece?a.piece.toLowerCase():!0;if("undefined"!==typeof a&&"square"in a)if(a.square in SQUARE_MAP$$module$Input_0)g=n=SQUARE_MAP$$module$Input_0[a.square],
C=!0;else return[];for(a=g;a<=n;a++)if(a&136)a+=7;else{var p=h[a];if(null!=p&&p.color===d)if(p.type===PAWN$$module$Input_0&&(!0===l||l===PAWN$$module$Input_0)){var m=a+PAWN_OFFSETS$$module$Input_0[d][0];null==h[m]&&(c(h,b,a,m,BITS$$module$Input_0.NORMAL),m=a+PAWN_OFFSETS$$module$Input_0[d][1],f[d]===rank$$module$Input_0(a)&&null==h[m]&&c(h,b,a,m,BITS$$module$Input_0.BIG_PAWN));for(r=2;4>r;r++)m=a+PAWN_OFFSETS$$module$Input_0[d][r],m&136||(null!=h[m]&&h[m].color===e?c(h,b,a,m,BITS$$module$Input_0.CAPTURE):
m===G&&c(h,b,a,G,BITS$$module$Input_0.EP_CAPTURE))}else if(!0===l||l===p.type){var r=0;for(g=PIECE_OFFSETS$$module$Input_0[p.type].length;r<g;r++){var U=PIECE_OFFSETS$$module$Input_0[p.type][r];for(m=a;;){m+=U;if(m&136)break;if(null==h[m])c(h,b,a,m,BITS$$module$Input_0.NORMAL);else{if(h[m].color===d)break;c(h,b,a,m,BITS$$module$Input_0.CAPTURE);break}if("n"===p.type||"k"===p.type)break}}}}if(!0===l||l===KING$$module$Input_0)C&&n!==w[d]||(t[d]&BITS$$module$Input_0.KSIDE_CASTLE&&(f=w[d],n=f+2,null!=
h[f+1]||null!=h[n]||Q(e,w[d])||Q(e,f+1)||Q(e,n)||c(h,b,w[d],n,BITS$$module$Input_0.KSIDE_CASTLE)),t[d]&BITS$$module$Input_0.QSIDE_CASTLE&&(f=w[d],n=f-2,null!=h[f-1]||null!=h[f-2]||null!=h[f-3]||Q(e,w[d])||Q(e,f-1)||Q(e,n)||c(h,b,w[d],n,BITS$$module$Input_0.QSIDE_CASTLE)));if(!B)return b;e=[];a=0;for(g=b.length;a<g;a++)I(b[a]),E(d)||e.push(b[a]),O();return e}function V(a,c){var b="";if(a.flags&BITS$$module$Input_0.KSIDE_CASTLE)b="O-O";else if(a.flags&BITS$$module$Input_0.QSIDE_CASTLE)b="O-O-O";else{if(a.piece!==
PAWN$$module$Input_0){var d=get_disambiguator$$module$Input_0(a,c);b+=a.piece.toUpperCase()+d}a.flags&(BITS$$module$Input_0.CAPTURE|BITS$$module$Input_0.EP_CAPTURE)&&(a.piece===PAWN$$module$Input_0&&(b+=algebraic$$module$Input_0(a.from)[0]),b+="x");b+=algebraic$$module$Input_0(a.to);a.flags&BITS$$module$Input_0.PROMOTION&&(b+="="+a.promotion.toUpperCase())}I(a);E(u)&&(b=E(u)&&0===y().length?b+"#":b+"+");O();return b}function Q(a,c){for(var b=SQUARE_MAP$$module$Input_0.a8;b<=SQUARE_MAP$$module$Input_0.h1;b++)if(b&
136)b+=7;else if(null!=h[b]&&h[b].color===a){var d=h[b],e=b-c,f=e+119;if(ATTACKS$$module$Input_0[f]&1<<SHIFTS$$module$Input_0[d.type])if(d.type===PAWN$$module$Input_0)if(0<e){if(d.color===WHITE$$module$Input_0)return!0}else{if(d.color===BLACK$$module$Input_0)return!0}else{if("n"===d.type||"k"===d.type)return!0;d=RAYS$$module$Input_0[f];e=b+d;for(f=!1;e!==c;){if(null!=h[e]){f=!0;break}e+=d}if(!f)return!0}}return!1}function E(a){return Q(swap_color$$module$Input_0(a),w[a])}function aa(){for(var a={},
c=[],b=0,d=0,e=SQUARE_MAP$$module$Input_0.a8;e<=SQUARE_MAP$$module$Input_0.h1;e++)if(d=(d+1)%2,e&136)e+=7;else{var f=h[e];f&&(a[f.type]=f.type in a?a[f.type]+1:1,f.type===BISHOP$$module$Input_0&&c.push(d),b++)}if(2===b||3===b&&(1===a[BISHOP$$module$Input_0]||1===a[KNIGHT$$module$Input_0]))return!0;if(b===a[BISHOP$$module$Input_0]+2){a=0;b=c.length;for(e=0;e<b;e++)a+=c[e];if(0===a||a===b)return!0}return!1}function ba(){for(var a=[],c={},b=!1;;){var d=O();if(!d)break;a.push(d)}for(;;){d=v().split(" ").slice(0,
4).join(" ");c[d]=d in c?c[d]+1:1;3<=c[d]&&(b=!0);if(!a.length)break;I(a.pop())}return b}function I(a){var c=u,b=swap_color$$module$Input_0(c);H.push({move:a,kings:{b:w.b,w:w.w},turn:u,castling:{b:t.b,w:t.w},ep_square:G,half_moves:D,move_number:N});h[a.to]=h[a.from];h[a.from]=null;a.flags&BITS$$module$Input_0.EP_CAPTURE&&(u===BLACK$$module$Input_0?h[a.to-16]=null:h[a.to+16]=null);a.flags&BITS$$module$Input_0.PROMOTION&&(h[a.to]={type:a.promotion,color:c});if(h[a.to].type===KING$$module$Input_0){w[h[a.to].color]=
a.to;if(a.flags&BITS$$module$Input_0.KSIDE_CASTLE){var d=a.to-1,e=a.to+1;h[d]=h[e];h[e]=null}else a.flags&BITS$$module$Input_0.QSIDE_CASTLE&&(d=a.to+1,e=a.to-2,h[d]=h[e],h[e]=null);t[c]=""}if(t[c])for(d=0,e=ROOKS$$module$Input_0[c].length;d<e;d++)if(a.from===ROOKS$$module$Input_0[c][d].square&&t[c]&ROOKS$$module$Input_0[c][d].flag){t[c]^=ROOKS$$module$Input_0[c][d].flag;break}if(t[b])for(d=0,e=ROOKS$$module$Input_0[b].length;d<e;d++)if(a.to===ROOKS$$module$Input_0[b][d].square&&t[b]&ROOKS$$module$Input_0[b][d].flag){t[b]^=
ROOKS$$module$Input_0[b][d].flag;break}G=a.flags&BITS$$module$Input_0.BIG_PAWN?"b"===u?a.to-16:a.to+16:EMPTY$$module$Input_0;a.piece===PAWN$$module$Input_0?D=0:a.flags&(BITS$$module$Input_0.CAPTURE|BITS$$module$Input_0.EP_CAPTURE)?D=0:D++;u===BLACK$$module$Input_0&&N++;u=swap_color$$module$Input_0(u)}function O(){var a=H.pop();if(null==a)return null;var c=a.move;w=a.kings;u=a.turn;t=a.castling;G=a.ep_square;D=a.half_moves;N=a.move_number;a=u;var b=swap_color$$module$Input_0(u);h[c.from]=h[c.to];h[c.from].type=
c.piece;h[c.to]=null;c.flags&BITS$$module$Input_0.CAPTURE?h[c.to]={type:c.captured,color:b}:c.flags&BITS$$module$Input_0.EP_CAPTURE&&(h[a===BLACK$$module$Input_0?c.to-16:c.to+16]={type:PAWN$$module$Input_0,color:b});if(c.flags&(BITS$$module$Input_0.KSIDE_CASTLE|BITS$$module$Input_0.QSIDE_CASTLE)){if(c.flags&BITS$$module$Input_0.KSIDE_CASTLE){var d=c.to+1;var e=c.to-1}else c.flags&BITS$$module$Input_0.QSIDE_CASTLE&&(d=c.to-2,e=c.to+1);h[d]=h[e];h[e]=null}return c}function ea(a,c){for(var b=stripped_san$$module$Input_0(a),
d=0;2>d;d++){if(d==PARSER_SLOPPY$$module$Input_0){if(!c)break;var e=!1,f=b.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(f){var g=f[1],n=f[2],C=f[3],B=f[4];1==n.length&&(e=!0)}else if(f=b.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))g=f[1],n=f[2],C=f[3],B=f[4],1==n.length&&(e=!0)}var l=infer_piece_type$$module$Input_0(b);l=y({legal:!0,piece:g?g:l});for(var p=0,m=l.length;p<m;p++)switch(d){case PARSER_STRICT$$module$Input_0:if(b===stripped_san$$module$Input_0(V(l[p],
l)))return l[p];break;case PARSER_SLOPPY$$module$Input_0:if(f){if(!(g&&g.toLowerCase()!=l[p].piece||SQUARE_MAP$$module$Input_0[n]!=l[p].from||SQUARE_MAP$$module$Input_0[C]!=l[p].to||B&&B.toLowerCase()!=l[p].promotion))return l[p];if(e){var r=algebraic$$module$Input_0(l[p].from);if(!(g&&g.toLowerCase()!=l[p].piece||SQUARE_MAP$$module$Input_0[C]!=l[p].to||n!=r[0]&&n!=r[1]||B&&B.toLowerCase()!=l[p].promotion))return l[p]}}}}return null}function Y(a){a=clone$$module$Input_0(a);a.san=V(a,y({legal:!0}));
a.to=algebraic$$module$Input_0(a.to);a.from=algebraic$$module$Input_0(a.from);var c="",b;for(b in BITS$$module$Input_0)BITS$$module$Input_0[b]&a.flags&&(c+=FLAGS$$module$Input_0[b]);a.flags=c;return a}function fa(a){for(var c=y({legal:!1}),b=0,d=u,e=0,f=c.length;e<f;e++){I(c[e]);if(!E(d))if(0<a-1){var g=fa(a-1);b+=g}else b++;O()}return b}var h=Array(128),w={w:EMPTY$$module$Input_0,b:EMPTY$$module$Input_0},u=WHITE$$module$Input_0,t={w:0,b:0},G=EMPTY$$module$Input_0,D=0,N=1,H=[],A={},x={};"undefined"===
typeof k?F(DEFAULT_POSITION$$module$Input_0):F(k);return{load:function(a){return F(a)},reset:function(){F(DEFAULT_POSITION$$module$Input_0)},moves:function(a){for(var c=y(a),b=[],d=0,e=c.length;d<e;d++)"undefined"!==typeof a&&"verbose"in a&&a.verbose?b.push(Y(c[d])):b.push(V(c[d],y({legal:!0})));return b},in_check:function(){return E(u)},in_checkmate:function(){return E(u)&&0===y().length},in_stalemate:function(){return!E(u)&&0===y().length},in_draw:function(){return 100<=D||!E(u)&&0===y().length||
aa()||ba()},insufficient_material:function(){return aa()},in_threefold_repetition:function(){return ba()},game_over:function(){return 100<=D||E(u)&&0===y().length||!E(u)&&0===y().length||aa()||ba()},validate_fen:function(a){return W(a)},fen:function(){return v()},board:function(){for(var a=[],c=[],b=SQUARE_MAP$$module$Input_0.a8;b<=SQUARE_MAP$$module$Input_0.h1;b++)null==h[b]?c.push(null):c.push({square:algebraic$$module$Input_0(b),type:h[b].type,color:h[b].color}),b+1&136&&(a.push(c),c=[],b+=8);
return a},pgn:function(a){var c="object"===typeof a&&"string"===typeof a.newline_char?a.newline_char:"\n",b="object"===typeof a&&"number"===typeof a.max_width?a.max_width:0,d=[];a=!1;for(var e in A)d.push("["+e+' "'+A[e]+'"]'+c),a=!0;a&&H.length&&d.push(c);e=function(l){var p=x[v()];"undefined"!==typeof p&&(l=""+l+(0<l.length?" ":"")+"{"+p+"}");return l};for(var f=[];0<H.length;)f.push(O());a=[];var g="";for(0===f.length&&a.push(e(""));0<f.length;){g=e(g);var n=f.pop();if(H.length||"b"!==n.color)"w"===
n.color&&(g.length&&a.push(g),g=N+".");else{var C=N+". ...";g=g?g+" "+C:C}g=g+" "+V(n,y({legal:!0}));I(n)}g.length&&a.push(e(g));"undefined"!==typeof A.Result&&a.push(A.Result);if(0===b)return d.join("")+a.join(" ");var B=function(){return 0<d.length&&" "===d[d.length-1]?(d.pop(),!0):!1};f=function(l,p){for(var m=$jscomp.makeIterator(p.split(" ")),r=m.next();!r.done;r=m.next())if(r=r.value){if(l+r.length>b){for(;B();)l--;d.push(c);l=0}d.push(r);l+=r.length;d.push(" ");l++}B()&&l--;return l};for(e=
g=0;e<a.length;e++)g+a[e].length>b&&a[e].includes("{")?g=f(g,a[e]):(g+a[e].length>b&&0!==e?(" "===d[d.length-1]&&d.pop(),d.push(c),g=0):0!==e&&(d.push(" "),g++),d.push(a[e]),g+=a[e].length);return d.join("")},load_pgn:function(a,c){function b(m){return m.replace(/\\/g,"\\")}var d="undefined"!==typeof c&&"sloppy"in c?c.sloppy:!1;a=a.trim();var e="object"===typeof c&&"string"===typeof c.newline_char?c.newline_char:"\r?\n",f=new RegExp("^(\\[((?:"+b(e)+")|.)*\\])(?:\\s*"+b(e)+"){2}");f=f.test(a)?f.exec(a)[1]:
"";F(DEFAULT_POSITION$$module$Input_0);var g=function(m,r){for(var U={},P=m.split(new RegExp(b("object"===typeof r&&"string"===typeof r.newline_char?r.newline_char:"\r?\n"))),T,J,K=0;K<P.length;K++)J=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/,T=P[K].replace(J,"$1"),J=P[K].replace(J,"$2"),0<trim$$module$Input_0(T).length&&(U[T]=J);return U}(f,c),n="";for(l in g)"fen"===l.toLowerCase()&&(n=g[l]),R([l,g[l]]);if(d){if(n&&!F(n,!0))return!1}else if("1"===g.SetUp&&!("FEN"in g&&F(g.FEN,!0)))return!1;var C=function(m){return Array.from(m).map(function(r){return 128>
r.charCodeAt(0)?r.charCodeAt(0).toString(16):encodeURIComponent(r).replace(/%/g,"").toLowerCase()}).join("")},B=function(m){m=m.replace(new RegExp(b(e),"g")," ");return"{"+C(m.slice(1,m.length-1))+"}"};var l=function(m){if(m.startsWith("{")&&m.endsWith("}"))return m=m.slice(1,m.length-1),0==m.length?"":decodeURIComponent("%"+m.match(/.{1,2}/g).join("%"))};f=a.replace(f,"").replace(new RegExp("({[^}]*})+?|;([^"+b(e)+"]*)","g"),function(m,r,U){return void 0!==r?B(r):" "+B("{"+U.slice(1)+"}")}).replace(new RegExp(b(e),
"g")," ");for(g=/(\([^\(\)]+\))+?/g;g.test(f);)f=f.replace(g,"");f=f.replace(/\d+\.(\.\.)?/g,"");f=f.replace(/\.\.\./g,"");f=f.replace(/\$\d+/g,"");f=trim$$module$Input_0(f).split(new RegExp(/\s+/));f=f.join(",").replace(/,,+/g,",").split(",");var p="";g="";for(n=0;n<f.length;n++)if(p=l(f[n]),void 0!==p)x[v()]=p;else if(p=ea(f[n],d),null==p)if(-1<TERMINATION_MARKERS$$module$Input_0.indexOf(f[n]))g=f[n];else return!1;else g="",I(p);g&&Object.keys(A).length&&!A.Result&&R(["Result",g]);return!0},header:function(){return R(arguments)},
turn:function(){return u},move:function(a,c){var b="undefined"!==typeof c&&"sloppy"in c?c.sloppy:!1,d=null;if("string"===typeof a)d=ea(a,b);else if("object"===typeof a){b=y();for(var e=0,f=b.length;e<f;e++)if(!(a.from!==algebraic$$module$Input_0(b[e].from)||a.to!==algebraic$$module$Input_0(b[e].to)||"promotion"in b[e]&&a.promotion!==b[e].promotion)){d=b[e];break}}if(!d)return null;b=Y(d);I(d);return b},undo:function(){var a=O();return a?Y(a):null},clear:function(){return q()},put:function(a,c){return X(a,
c)},get:function(a){return M(a)},ascii:function(){for(var a="   +------------------------+\n",c=SQUARE_MAP$$module$Input_0.a8;c<=SQUARE_MAP$$module$Input_0.h1;c++){0===file$$module$Input_0(c)&&(a+=" "+"87654321"[rank$$module$Input_0(c)]+" |");if(null==h[c])a+=" . ";else{var b=h[c].type;b=h[c].color===WHITE$$module$Input_0?b.toUpperCase():b.toLowerCase();a+=" "+b+" "}c+1&136&&(a+="|\n",c+=8)}return a+"   +------------------------+\n     a  b  c  d  e  f  g  h"},remove:function(a){var c=M(a);h[SQUARE_MAP$$module$Input_0[a]]=
null;c&&c.type===KING$$module$Input_0&&(w[c.color]=EMPTY$$module$Input_0);L(v());return c},perft:function(a){return fa(a)},square_color:function(a){return a in SQUARE_MAP$$module$Input_0?(a=SQUARE_MAP$$module$Input_0[a],0===(rank$$module$Input_0(a)+file$$module$Input_0(a))%2?"light":"dark"):null},history:function(a){var c=[],b=[];a="undefined"!==typeof a&&"verbose"in a&&a.verbose;for(;0<H.length;)c.push(O());for(;0<c.length;){var d=c.pop();a?b.push(Y(d)):b.push(V(d,y({legal:!0})));I(d)}return b},
get_comment:function(){return x[v()]},set_comment:function(a){x[v()]=a.replace("{","[").replace("}","]")},delete_comment:function(){var a=x[v()];delete x[v()];return a},get_comments:function(){z();return Object.keys(x).map(function(a){return{fen:a,comment:x[a]}})},delete_comments:function(){z();return Object.keys(x).map(function(a){var c=x[a];delete x[a];return{fen:a,comment:c}})}}},module$Input_0={BISHOP:BISHOP$$module$Input_0,BLACK:BLACK$$module$Input_0,Chess:Chess$$module$Input_0,EMPTY:EMPTY$$module$Input_0,
FLAGS:FLAGS$$module$Input_0,KING:KING$$module$Input_0,KNIGHT:KNIGHT$$module$Input_0,PAWN:PAWN$$module$Input_0,QUEEN:QUEEN$$module$Input_0,ROOK:ROOK$$module$Input_0,SQUARES:SQUARES$$module$Input_0,WHITE:WHITE$$module$Input_0};